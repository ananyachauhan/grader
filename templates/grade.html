<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade Assignment - MaroonGrader</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="top-nav-content">
            <a href="/" class="logo">
                <span class="logo-icon">MG</span>
                <span>MaroonGrader</span>
            </a>
            <div class="breadcrumbs" id="breadcrumbs">
                <a href="/assignments" id="breadcrumb-assignments-link">Assignments</a>
                <span class="breadcrumbs-separator">/</span>
                <span id="breadcrumb-assignment-name">Grade</span>
            </div>
            <div class="user-menu">
                <span style="color: var(--text-medium); font-size: 14px;">TA/Professor</span>
            </div>
        </div>
    </nav>

    <!-- Main Layout -->
    <div class="main-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <ul class="sidebar-nav">
                <!-- Sidebar will be populated by sidebar.js -->
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <h1 id="assignment-name-header">Grade Assignment</h1>
                <p id="assignment-description">Loading assignment details...</p>
            </div>

            <!-- Assignment Info -->
            <div class="card">
                <div class="card-header">
                    <h3>Assignment Details</h3>
                </div>
                <div id="assignment-info">
                    <p style="color: var(--text-medium);">Loading assignment details...</p>
                </div>
            </div>

            <!-- Authentication Status -->
            <div class="card" id="auth-status-section">
                <div class="card-header">
                    <h3>Google Drive Authentication</h3>
                </div>
                <div id="auth-status">
                    <p style="color: var(--text-medium);">Checking authentication status...</p>
                </div>
            </div>

            <!-- Documents Selection -->
            <div class="card">
                <div class="card-header">
                    <h3>Select Documents to Grade</h3>
                </div>
            
                <div class="form-group">
                    <button id="load-docs-btn" class="btn btn-secondary" disabled>Load Documents from Drive Folder</button>
                </div>

                <div id="documents-container" class="hidden">
                    <div class="documents-header">
                        <label>
                            <input type="checkbox" id="select-all"> Select All
                        </label>
                        <span id="selected-count">0 selected</span>
                    </div>
                    <div id="documents-list"></div>
                </div>

                <div class="form-group" style="margin-top: 20px;">
                    <button id="grade-btn" class="btn btn-primary" disabled>Grade Selected Documents</button>
                </div>

                <div id="progress-container" class="hidden">
                    <div class="progress-bar">
                        <div id="progress-fill"></div>
                    </div>
                    <p id="progress-text">Preparing...</p>
                </div>
            </div>

            <!-- Results Dashboard -->
            <div id="results-section" class="card hidden">
                <div class="card-header">
                    <h2>Grading Results</h2>
                </div>
                
                <div class="results-summary">
                    <div class="stat">
                        <span class="stat-value" id="total-graded">0</span>
                        <span class="stat-label">Documents Graded</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="avg-score">0</span>
                        <span class="stat-label">Average Score</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="success-count">0</span>
                        <span class="stat-label">Successful</span>
                    </div>
                </div>

                <div id="results-table"></div>

                <div class="results-actions">
                    <button id="open-all-btn" class="btn btn-secondary">Open All in Drive</button>
                    <button id="review-btn" class="btn btn-primary">Review</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        const assignmentId = new URLSearchParams(window.location.search).get('assignment_id');
        const sectionId = new URLSearchParams(window.location.search).get('section_id');
        const sectionNumber = new URLSearchParams(window.location.search).get('section_number');
        
        // Update breadcrumb links
        if (sectionId && sectionNumber) {
            const assignmentsUrl = `/assignments?section_id=${sectionId}&section_number=${sectionNumber}`;
            const breadcrumbLink = document.getElementById('breadcrumb-assignments-link');
            if (breadcrumbLink) {
                breadcrumbLink.href = assignmentsUrl;
            }
        }
    </script>
    <script src="{{ url_for('static', filename='js/sidebar.js') }}"></script>
    <script src="{{ url_for('static', filename='js/grade.js') }}"></script>
</body>
</html>

